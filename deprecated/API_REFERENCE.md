# Reachy Mini Scratch Extension - API リファレンス

このドキュメントでは、拡張機能で利用可能な全てのブロックを詳しく説明します。

## 📋 目次

- [基本動作](#基本動作)
- [頭の制御](#頭の制御)
- [アンテナ制御](#アンテナ制御)
- [モーター制御](#モーター制御)
- [事前録画された動作](#事前録画された動作)
- [動作制御](#動作制御)
- [状態取得](#状態取得)
- [システム情報](#システム情報)

---

## 🤖 基本動作

### `ロボットを起こす`
**種類**: コマンドブロック
**説明**: ロボットを起動状態にします。モーターが有効になり、制御可能になります。

**使用例**:
```
緑の旗が押されたとき
  ロボットを起こす
```

**対応API**: `POST /api/move/play/wake_up`

---

### `ロボットを寝かせる`
**種類**: コマンドブロック
**説明**: ロボットをスリープ状態にします。安全な姿勢に移行してモーターを無効化します。

**使用例**:
```
プログラム終了時
  ロボットを寝かせる
```

**対応API**: `POST /api/move/play/goto_sleep`

---

## 🎯 頭の制御

### `頭を [方向] に動かす`
**種類**: コマンドブロック
**パラメータ**:
- `方向`: 上 / 下 / 左 / 右 / 左上 / 右上

**説明**: 簡単な方向指定で頭を動かします。初心者向けの簡単なブロックです。

**使用例**:
```
[上向き矢印]キーが押されたとき
  頭を [上] に動かす
```

**角度の内部設定**:
- 上: pitch +15°
- 下: pitch -15°
- 左: yaw +20°
- 右: yaw -20°
- 左上: pitch +15°, yaw +20°
- 右上: pitch +15°, yaw -20°

**対応API**: `POST /api/move/goto`

---

### `頭を動かす pitch:[PITCH] yaw:[YAW] roll:[ROLL] 時間:[DURATION]秒`
**種類**: コマンドブロック
**パラメータ**:
- `PITCH`: -30 ~ 30° (上下の動き)
- `YAW`: -40 ~ 40° (左右の回転)
- `ROLL`: -30 ~ 30° (左右の傾き)
- `DURATION`: 移動時間（秒）

**説明**: 詳細な角度指定で頭を動かします。上級者向けの精密制御が可能です。

**使用例**:
```
頭を動かす pitch:[10] yaw:[15] roll:[5] 時間:[2.0]秒
```

**注意**: 角度は度数法で指定します。大きすぎる角度は避けてください。

**対応API**: `POST /api/move/goto`

---

### `頭を正面に戻す`
**種類**: コマンドブロック
**説明**: 頭をデフォルト位置（正面、まっすぐ）に戻します。

**使用例**:
```
[スペース]キーが押されたとき
  頭を正面に戻す
```

**対応API**: `POST /api/move/goto`

---

## 📡 アンテナ制御

### `アンテナを動かす 左:[LEFT]° 右:[RIGHT]°`
**種類**: コマンドブロック
**パラメータ**:
- `LEFT`: 左アンテナの角度（-45 ~ 45°）
- `RIGHT`: 右アンテナの角度（-45 ~ 45°）

**説明**: 左右のアンテナを個別に制御します。非対称な動きが可能です。

**使用例**:
```
アンテナを動かす 左:[30] 右:[-30]
// 左が上がり、右が下がる
```

**対応API**: `POST /api/move/goto`

---

### `アンテナを [ANGLE]° にする`
**種類**: コマンドブロック
**パラメータ**:
- `ANGLE`: アンテナの角度（-45 ~ 45°）

**説明**: 両方のアンテナを同じ角度に設定します。対称な動きを簡単に作れます。

**使用例**:
```
アンテナを [20]° にする
// 両方のアンテナが20°になる
```

**対応API**: `POST /api/move/goto`

---

## ⚙️ モーター制御

### `モーターを [MODE] にする`
**種類**: コマンドブロック
**パラメータ**:
- `MODE`:
  - `ON (有効)` - モーターが有効、位置制御可能
  - `OFF (無効)` - モーターが無効、フリーに動く
  - `コンプライアント` - 重力補償モード、手で動かせる

**説明**: モーターの動作モードを変更します。

**使用例**:
```
// 手で動かせるようにする
モーターを [コンプライアント] にする

// 制御可能な状態に戻す
モーターを [ON (有効)] にする
```

**ユースケース**:
- **ON**: 通常の制御
- **OFF**: 電力節約、完全にフリー
- **コンプライアント**: ティーチング（手で動かして位置を記録）

**対応API**: `POST /api/motors/set_mode/{mode}`

---

### `モーターの状態`
**種類**: レポーターブロック
**戻り値**: `enabled` / `disabled` / `gravity_compensation`

**説明**: 現在のモーターの状態を取得します。

**使用例**:
```
もし [モーターの状態] = [enabled] なら
  // モーターが有効な場合の処理
終わり
```

**対応API**: `GET /api/motors/status`

---

## 🎬 事前録画された動作

### `動作を再生 [DATASET]/[MOVE]`
**種類**: コマンドブロック
**パラメータ**:
- `DATASET`: データセット名（デフォルト: `pollen-robotics/reachy_mini_moves`）
- `MOVE`: 動作名（例: `nod-yes`, `shake-no`, `happy`）

**説明**: Hugging Face上の事前録画された動作を再生します。

**使用例**:
```
// うなずく動作
動作を再生 [pollen-robotics/reachy_mini_moves]/[nod-yes]

// 首を振る動作
動作を再生 [pollen-robotics/reachy_mini_moves]/[shake-no]
```

**利用可能な動作例**:
- `nod-yes` - うなずく
- `shake-no` - 首を振る
- `happy` - 嬉しい表現
- `sad` - 悲しい表現
- `curious` - 好奇心

**対応API**: `POST /api/move/play/recorded-move-dataset/{dataset}/{move}`

---

### `利用可能な動作リスト [DATASET]`
**種類**: レポーターブロック
**パラメータ**:
- `DATASET`: データセット名

**戻り値**: カンマ区切りの動作リスト

**説明**: 指定されたデータセットで利用可能な動作のリストを取得します。

**使用例**:
```
[利用可能な動作リスト [pollen-robotics/reachy_mini_moves]] と言う
```

**対応API**: `GET /api/move/recorded-move-datasets/list/{dataset}`

---

## 🎮 動作制御

### `実行中の動作を停止`
**種類**: コマンドブロック
**説明**: 最後に実行した動作を停止します。緊急停止に便利です。

**使用例**:
```
[s]キーが押されたとき
  実行中の動作を停止
```

**対応API**: `POST /api/move/stop`

---

### `実行中の動作数`
**種類**: レポーターブロック
**戻り値**: 数値（実行中の動作の数）

**説明**: 現在実行中の動作がいくつあるか取得します。

**使用例**:
```
もし [実行中の動作数] > [0] なら
  [動作実行中...] と言う
終わり
```

**対応API**: `GET /api/move/running`

---

## 📊 状態取得

### `頭のpitch角度`
**種類**: レポーターブロック
**戻り値**: 数値（度数法）

**説明**: 現在の頭のpitch角度（上下の動き）を取得します。

**使用例**:
```
[pitch: ] と [頭のpitch角度] と言う
```

**対応API**: `GET /api/state/full`

---

### `頭のyaw角度`
**種類**: レポーターブロック
**戻り値**: 数値（度数法）

**説明**: 現在の頭のyaw角度（左右の回転）を取得します。

**対応API**: `GET /api/state/full`

---

### `頭のroll角度`
**種類**: レポーターブロック
**戻り値**: 数値（度数法）

**説明**: 現在の頭のroll角度（左右の傾き）を取得します。

**対応API**: `GET /api/state/full`

---

### `左アンテナの角度`
**種類**: レポーターブロック
**戻り値**: 数値（度数法）

**説明**: 左アンテナの現在角度を取得します。

**対応API**: `GET /api/state/full`

---

### `右アンテナの角度`
**種類**: レポーターブロック
**戻り値**: 数値（度数法）

**説明**: 右アンテナの現在角度を取得します。

**対応API**: `GET /api/state/full`

---

### `体のyaw角度`
**種類**: レポーターブロック
**戻り値**: 数値（度数法）

**説明**: 体（ベース）の回転角度を取得します。

**対応API**: `GET /api/state/present_body_yaw`

---

## 🔧 システム情報

### `daemon状態`
**種類**: レポーターブロック
**戻り値**: `running` / `stopped` / `unknown`

**説明**: Reachy Mini daemonの状態を取得します。

**使用例**:
```
もし [daemon状態] = [running] なら
  [システム正常] と言う
終わり
```

**対応API**: `GET /api/daemon/status`

---

## 📐 角度について

### Pitch（ピッチ）
```
      上を向く (+)
         ↑
    ← ロボット →
         ↓
      下を向く (-)
```

### Yaw（ヨー）
```
    左を向く (+)
         ↑
    ← ロボット →
         ↓
    右を向く (-)
```

### Roll（ロール）
```
    左に傾く (+)
         ↑
    ← ロボット →
         ↓
    右に傾く (-)
```

---

## 🔗 関連リンク

- [REST API ドキュメント](http://localhost:8000/docs) - daemon起動中にアクセス可能
- [Reachy Mini GitHub](https://github.com/pollen-robotics/reachy_mini)
- [サンプルプロジェクト](SAMPLE_PROJECTS.md)
